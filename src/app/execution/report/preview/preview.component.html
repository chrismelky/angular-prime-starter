<div fxLayout="column" fxLayoutGap="0px">
  <div
    fxLayout="row"
    fxLayoutGap="10px"
    fxLayoutAlign="center"
    class="report-name"
  >
    <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="start center">
      <i class="pi pi-file"></i>
      <span class="report-title">
        {{ report?.name }}
      </span>
    </div>
  </div>

  <p-splitter [panelSizes]="[18, 82]" layout="horizontal">
    <ng-template pTemplate>
      <form
        name="paramForm"
        role="form"
        novalidate
        [formGroup]="paramForm"
        fxFlex
      >
        <div
          fxLayout="column"
          fxLayoutGap="8px"
          style="width: 100%; min-height: 400px; overflow-y: scroll"
        >
          <div
            style="width: 100%"
            class="report-controls"
            fxLayout="row"
            fxLayoutGap="8px"
            fxLayoutAlign="start center"
          >
            <i class="pi pi-filter"></i>
            <span> Advance Filters </span>
          </div>

          <div
            *ngIf="params"
            class="report-filter"
            fxLayout="column"
            fxLayoutGap="10px"
            style="width: 100%; margin-top: 10px"
          >
            <!-- Period -->
            <div class="p-field" fxFlex *ngIf="params?.includes('period_id')">
              <span class="p-float-label">
                <p-dropdown
                  id="period_id"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="periods!"
                  formControlName="period_id"
                ></p-dropdown>
                <label for="period_id">Periods</label>
              </span>
              <span
                *ngIf="
                  paramForm.get('period_id')!.invalid &&
                  (paramForm.get('period_id')!.dirty ||
                    paramForm.get('period_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('period_id')?.errors?.required"
                  >Period is required.</small
                >
              </span>
            </div>
            <!-- Fund Source -->
            <div
              class="p-field"
              fxFlex
              *ngIf="params?.includes('fund_source_id')"
            >
              <span class="p-float-label">
                <p-dropdown
                  id="fund_source_id"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="fundSources!"
                  formControlName="fund_source_id"
                ></p-dropdown>
                <label for="fund_source_id">Fund Source </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('fund_source_id')!.invalid &&
                  (paramForm.get('fund_source_id')!.dirty ||
                    paramForm.get('fund_source_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('fund_source_id')?.errors?.required"
                  >Fund Source is required.</small
                >
              </span>
            </div>

            <!-- Section -->
            <div class="p-field" fxFlex *ngIf="params?.includes('section_id')">
              <span class="p-float-label">
                <p-dropdown
                  id="section_id"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="sections!"
                  formControlName="section_id"
                ></p-dropdown>
                <label for="section_id">Cost Centre </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('section_id')!.invalid &&
                  (paramForm.get('section_id')!.dirty ||
                    paramForm.get('section_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('section_id')?.errors?.required"
                  >Cost Centre is required.</small
                >
              </span>
            </div>

            <!-- Departmrnt -->
            <div
              class="p-field"
              fxFlex
              *ngIf="params?.includes('department_id')"
            >
              <span class="p-float-label">
                <p-dropdown
                  id="department_id"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="departments!"
                  formControlName="department_id"
                ></p-dropdown>
                <label for="department_id">Departments </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('department_id')!.invalid &&
                  (paramForm.get('department_id')!.dirty ||
                    paramForm.get('department_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('department_id')?.errors?.required"
                  >Department is required.</small
                >
              </span>
            </div>

            <div
              class="p-field"
              fxFlex
              *ngIf="params?.includes('fund_source_pe')"
            >
              <span class="p-float-label">
                <p-dropdown
                  id="fund_source_pe"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="peFundSources!"
                  formControlName="fund_source_pe"
                ></p-dropdown>
                <label for="fund_source_pe">PE Fund Source </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('fund_source_pe')!.invalid &&
                  (paramForm.get('fund_source_pe')!.dirty ||
                    paramForm.get('fund_source_pe')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('fund_source_pe')?.errors?.required"
                  >PE Fund Source is required.</small
                >
              </span>
            </div>
            <!-- Sector -->
            <div class="p-field" fxFlex *ngIf="params?.includes('sector_id')">
              <span class="p-float-label">
                <p-dropdown
                  id="sector_id"
                  optionValue="id"
                  optionLabel="name"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="sectors!"
                  formControlName="sector_id"
                ></p-dropdown>
                <label for="sector_id">Sectors </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('sector_id')!.invalid &&
                  (paramForm.get('sector_id')!.dirty ||
                    paramForm.get('sector_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('sector_id')?.errors?.required"
                  >Sector is required.</small
                >
              </span>
            </div>

            <!-- Priortiy area -->
            <div
              class="p-field"
              fxFlex
              *ngIf="params?.includes('priority_area_id')"
            >
              <span class="p-float-label">
                <p-dropdown
                  optionValue="id"
                  optionLabel="description"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="priorityAreas!"
                  formControlName="priority_area_id"
                ></p-dropdown>
                <label for="priority_area_id">Priority Areas </label>
              </span>
              <span
                *ngIf="
                  paramForm.get('priority_area_id')!.invalid &&
                  (paramForm.get('priority_area_id')!.dirty ||
                    paramForm.get('priority_area_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('priority_area_id')?.errors?.required"
                  >Priority Areas is required.</small
                >
              </span>
            </div>

            <div
              class="p-field"
              fxFlex
              *ngIf="params?.includes('intervention_id')"
            >
              <span class="p-float-label">
                <p-multiSelect
                  id="intervention_id"
                  optionValue="id"
                  optionLabel="description"
                  [filter]="true"
                  class="p-inputtext-sm"
                  appendTo="body"
                  [options]="interventions!"
                  formControlName="intervention_id"
                ></p-multiSelect>
                <label for="intervention_id">Intervention</label>
              </span>
              <span
                *ngIf="
                  paramForm.get('intervention_id')!.invalid &&
                  (paramForm.get('intervention_id')!.dirty ||
                    paramForm.get('intervention_id')!.touched ||
                    formError)
                "
              >
                <small
                  class="p-error"
                  *ngIf="paramForm.get('intervention_id')?.errors?.required"
                  >Intervention is required.</small
                >
              </span>
            </div>

            <button
              style="border-radius: 0px"
              class="p-button-plain"
              label="Get Report"
              pButton
              (click)="getReport()"
            ></button>
          </div>
        </div>
      </form>
    </ng-template>
    <ng-template pTemplate>
      <div
        fxLayout="column"
        fxLayoutGap="8px"
        fxFlex
        style="min-height: 400px; overflow-y: scroll"
      >
        <div
          class="report-controls"
          fxLayout="row"
          fxLayoutGap="10px"
          fxLayoutAlign="space-between center"
        >
          <span></span>
          <p-paginator
            fxFlex="1 0 25%"
            styleClass="report-preview"
            [showJumpToPageDropdown]="true"
            [showPageLinks]="false"
            [alwaysShow]="true"
            [rows]="1"
            dropdownAppendTo="body"
            [totalRecords]="totalPages"
          ></p-paginator>
          <span fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
            <button
              style="color: rgb(139, 3, 3)"
              pButton
              (click)="download('pdf')"
              icon="pi pi-file-pdf"
              class="p-button-icon p-button-rounded p-button-plain p-button-text"
            ></button>
            <!-- <i style="color: rgb(139, 3, 3)" class="pi pi-file-pdf"></i>
            <i style="color: rgb(6, 158, 6)" class="pi pi-file-excel"></i>
            <i style="color: rgb(5, 133, 238)" class="pi pi-file"></i> -->
          </span>
        </div>
        <div class="loader-area" style="min-height: 400px">
          <app-loader [isLoading]="reportIsLoading"></app-loader>
          <div #reportBody></div>
        </div>
      </div>
    </ng-template>
  </p-splitter>
</div>
