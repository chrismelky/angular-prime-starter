<div class="content" fxLayout="column" fxLayoutGap="0.75rem">
  <!-- Filter Panel -->
  <p-card class="filter filter-no-adv">
    <ng-template pTemplate="header">
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
        <i class="pi pi-filter"></i>
        <span class="card-header-text">Filter</span>
      </div>
    </ng-template>
    <div fxLayout="column" fxLayoutGap="4px">
      <div fxLayout="row wrap" fxLayoutGap="10px">
        <div
          fxLayout="row wrap"
          fxLayoutGap="0.75rem"
          fxFlex
          fxLayoutAlign="start center"
        >
          <div class="p-field" fxFlex>
            <app-admin-hierarchy-tree
              (onSelect)="onAdminHierarchySelection($event)"
              [returnType]="'object'"
            >
            </app-admin-hierarchy-tree>
          </div>
          <div class="p-field" fxFlex>
            <span class="p-float-label">
              <p-dropdown
                id="financial_year_id"
                optionValue="id"
                optionLabel="name"
                [autoDisplayFirst]="false"
                [filter]="true"
                class="p-inputtext-sm"
                [options]="financialYears!"
                [(ngModel)]="financial_year_id"
              ></p-dropdown>
              <label for="financial_year_id">Financial Year </label>
            </span>
          </div>
          <div class="p-field" fxFlex>
            <span class="p-float-label">
              <p-dropdown
                id="budgetType"
                optionValue="name"
                optionLabel="name"
                [autoDisplayFirst]="false"
                [filter]="true"
                class="p-inputtext-sm"
                [options]="budgetTypes!"
                [(ngModel)]="budgetType"
              ></p-dropdown>
              <label for="budgetType">Budget Type </label>
            </span>
          </div>
          <div class="p-field" fxFlex>
            <span class="p-float-label">
              <p-dropdown
                id="cas_plan_id"
                optionValue="id"
                optionLabel="name"
                [autoDisplayFirst]="false"
                [filter]="true"
                class="p-inputtext-sm"
                [options]="casPlans!"
                (onChange)="filterChanged()"
                [(ngModel)]="cas_plan_id"
              ></p-dropdown>
              <label for="cas_plan_id">Cas Plans </label>
            </span>
          </div>
        </div>
      </div>
    </div>
  </p-card>

  <!-- Table Panel -->
  <p-card>
    <p-treeTable
      #table
      [lazy]="true"
      [resizableColumns]="true"
      [autoLayout]="true"
      [loading]="isLoading"
      [columns]="cols"
      [scrollable]="true"
      [value]="casPlanContents!"
      (onLazyLoad)="onSortChange($event)"
      (onNodeExpand)="onNodeExpand($event)"
      [customSort]="true"
    >
      <ng-template pTemplate="caption">
        <div fxLayout="row" fxLayoutAlign="space-between center">
          <span class="card-header-text">Reports</span>
        </div>
      </ng-template>
      <ng-template
        pTemplate="body"
        let-rowNode
        let-rowData="rowData"
        let-columns="columns"
      >
        <tr>
          <td
            style="height: 36px !important"
            *ngFor="let col of columns; let i = index"
          >
            <div fxLayout="row" fxLayoutGap="4px" fxLayoutAlign="start center">
              <p-treeTableToggler
                [rowNode]="rowNode"
                *ngIf="i === 0"
              ></p-treeTableToggler>

              <span> {{ rowData[col.field] }}</span>
              <button
                *ngIf="rowData.report_id || rowData.data_sets?.length"
                style="color: #ff5722"
                class="p-button-icon p-button-text p-icon-only p-button-rounded"
                icon="pi pi-file-pdf"
                pButton
                (click)="getReport('pdf', rowData)"
              ></button>
              <!-- <button
                style="color: #0c7239"
                class="p-button-icon p-button-text"
                icon="pi pi-file-excel"
                label="EXCEL"
                pButton
                (click)="getReport('xlsx')"
              ></button>
              <button
                style="color: #1665c0"
                class="p-button-icon p-button-text"
                icon="pi pi-file-o"
                label="WORD"
                pButton
                (click)="getReport('rtf')"
              ></button> -->
            </div>
          </td>
          <!-- <td style="height: 36px !important">
            <div fxLayout="row" fxLayoutAlign="end">
              <div fxLayout="row" fxLayoutGap="2px" *ngIf="rowData.is_file">
                <button
                  pButton
                  icon="pi pi-download"
                  class="p-button-icon p-button-text"
                  [disabled]="
                    !this.admin_hierarchy_id ||
                    !this.financial_year_id ||
                    !this.budgetType
                  "
                  (click)="downloadReport(rowData)"
                ></button>
              </div>
              <div fxLayout="row" fxLayoutGap="2px" *ngIf="rowData.report_id">
                <button
                  pButton
                  icon="pi pi-print"
                  class="p-button-icon p-button-text"
                  [disabled]="
                    !this.admin_hierarchy_id ||
                    !this.financial_year_id ||
                    !this.budgetType
                  "
                  (click)="getReport(rowData)"
                  label="Preview"
                ></button>
              </div>
            </div>
          </td> -->
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage"> No data found </ng-template>
    </p-treeTable>
    <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="center">
      <p-paginator
        #paginator
        [alwaysShow]="parents?.length! > 0"
        [rows]="per_page"
        dropdownAppendTo="body"
        [showCurrentPageReport]="true"
        [totalRecords]="totalItems"
        [rowsPerPageOptions]="perPageOptions"
        (onPageChange)="pageChanged($event)"
      ></p-paginator>
    </div>
  </p-card>
</div>

<p-confirmDialog
  [breakpoints]="{ '960px': '75vw', '640px': '100vw' }"
  [style]="{ width: '50vw' }"
  header="Confirmation Delete Report"
  icon="pi pi-exclamation-triangle"
></p-confirmDialog>
